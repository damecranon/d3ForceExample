<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3 Force Layout</title>
    <link rel="stylesheet" href="css/index.css" />
</head>
<body>



 <script src="https://d3js.org/d3.v4.min.js"></script>
<script src="js/d3.js"></script>
<script type="text/javascript">
    /* start out the d3 layout */
    var width = 1100;
    var height = 800;

    var nodes = [
        {"id": 1, "name": "Lillian", "sex": "F", "group":1},
        {"id": 2, "name": "Gordon", "sex": "M", "group":1},
        {"id" : 3, "name": "Sylvester", "sex": "M", "group":1},
        {"id": 4, "name": "Mary", "sex": "F", "group":1},
        {"id": 5, "name": "Helen", "sex": "F", "group":1},
        {"id": 6, "name": "Jamie", "sex": "M", "group":1},
        {"id": 7, "name": "Jessie", "sex": "F", "group":1},
        {"id": 8, "name": "Ashton", "sex": "M", "group":1},
        {"id": 9, "name": "Duncan", "sex": "M", "group":1},
        {"id": 10, "name": "Evette", "sex": "F", "group":1},
        {"id": 11, "name": "Mauer", "sex": "M", "group":1},
        {"id": 12, "name": "Fray", "sex": "F", "group":1},
        {"id": 13, "name": "Duke", "sex": "M", "group":1},
        {"id": 14, "name": "Baron", "sex": "M", "group":1},
        {"id": 15, "name": "Infante", "sex": "M", "group":1},
        {"id:": 16, "name": "Percy", "sex": "M", "group":1},
        {"id": 17,  "name": "Cynthia", "sex": "F", "group":1}

    ];

    var svg = d3.select('body').append('svg').attr('width', width).attr('height', height);

    //the parent g tag
    var parentg = svg.append('g').attr('class', 'parentg');
    var childg;

    //default name
    var default_name = "New Node";

    //these values will check to see if they are null or not in mouse events
    var selected_node;


    //the simulation(force layout)
    var collideMethod = d3.forceCollide( function(d){return d.r + 8 }).iterations(16);

    //first we will set up the simulation
    var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function(d){return d.id;}))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height /2))
        .force("collide", collideMethod);

function update() {
      childg = parentg.selectAll('.nodes').data(nodes, function (d) {
          return d.name;
      });
      var childNode =  childg.enter().append('g').attr('class', 'nodes');
      childNode.append('circle').attr('r', 20).attr('fill', circlecolor);
      childNode.append('text').attr('dx', 12).attr('dy', '.35em').text(function (d) {
        return d.name;
    });

    childg = childNode.merge(childg);
    simulation.nodes(nodes).on("tick", ticked);
}



function ticked(){
        //update circle positions each tick of simulation
        childg.attr('transform', function(d){return 'translate(' + d.x + ',' + d.y + ')'; }).select('.nodes');
}


    function circlecolor(d){
        if (d.sex == "M"){
            return "blue";
        } else if (d.sex == "F") {
            return "pink";
        } else {
            return "red";
        }
    }
svg.on("click", function (event) {
    var mDown = d3.mouse(svg.node());
    console.log("Mouse Position: " +mDown);
    nodes.push({x: mDown[0], y:mDown[1], name: default_name + " " + nodes.length, group:1});
    selected_node = null;
    update();
    simulation.alpha(0.1).restart();

});

update();
</script>
</body>
</html>