<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D3 Force Layout</title>
    <link rel="stylesheet" href="css/index.css" />
</head>
<body>



 <script src="https://d3js.org/d3.v4.min.js"></script>
<script src="js/d3.js"></script>
<script type="text/javascript">
    /* start out the d3 layout */
    var width = 1100;
    var height = 800;

    var nodes = [
        {"name": "Lillian", "sex": "F", "group":1},
        {"name": "Gordon", "sex": "M", "group":1},
        {"name": "Sylvester", "sex": "M", "group":1},
        {"name": "Mary", "sex": "F", "group":1},
        {"name": "Helen", "sex": "F", "group":1},
        {"name": "Jamie", "sex": "M", "group":1},
        {"name": "Jessie", "sex": "F", "group":1},
        {"name": "Ashton", "sex": "M", "group":1},
        {"name": "Duncan", "sex": "M", "group":1},
        {"name": "Evette", "sex": "F", "group":1},
        {"name": "Mauer", "sex": "M", "group":1},
        {"name": "Fray", "sex": "F", "group":1},
        {"name": "Duke", "sex": "M", "group":1},
        {"name": "Baron", "sex": "M", "group":1},
        {"name": "Infante", "sex": "M", "group":1},
        {"name": "Percy", "sex": "M", "group":1},
        {"name": "Cynthia", "sex": "F", "group":1}

    ];

    var svg = d3.select('body').append('svg').attr('width', width).attr('height', height);

    //the parent g tag
    var parentg = svg.append('g').attr('class', 'parentg').selectAll('g');
    var childg;

    //default name
    var default_name = "New Node";

    //these values will check to see if they are null or not in mouse events
    var selected_node;


    //the simulation(force layout)
    var collideMethod = d3.forceCollide( function(d){return d.r + 8 }).iterations(16);

    //first we will set up the simulation
    var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function(d){return d.id;}))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height /2))
        .force("collide", collideMethod);





function update() {
   /* node = svg.append('svg:g')
        .attr("class", "nodes")
        .selectAll("g")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("r", 10)
        .attr("fill", circlecolor); */


      childg = parentg.data(nodes).enter().append('g');
      childnode = childg.append("circle").attr('r', 20).attr('fill', circlecolor).merge(childg);
      childnode.append('svg:a').attr('xlink:href', function (d) {return d.url || '#';})
          .append('text').attr('dx', 12).attr('dy', '.35em').text(function (d) {return d.name});
      childg.exit().remove();
}

simulation.on("tick", ticked).nodes(nodes);

function ticked(){
        //update circle positions each tick of simulation

    //node.attr("cx", function(d){return d.x}).attr("cy", function(d){return d.y});
    childg.attr('transform', function(d){return 'translate(' + d.x + ',' + d.y + ')'; });
}


    function circlecolor(d){
        if (d.sex == "M"){
            return "blue";
        } else {
            return "pink";
        }
    }
svg.on("click", function (event) {

    //alert("click works");
     var mDown = d3.mouse(svg.node());
    console.log("Mouse Position: " +mDown);
    nodes.push({x: mDown[0], y:mDown[1], name: default_name + " " + nodes.length, group:1});
    selected_node = null;
    simulation.stop();
    update();
    simulation.restart();

});

update();
</script>
</body>
</html>